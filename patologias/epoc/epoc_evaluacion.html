<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EPOC — Evaluación y Estratificación</title>
<style>
  :root{
    --bg:#0b1220; --panel:#111827; --card:#111827; --ink:#e5e7eb; --muted:#94a3b8; --line:#243244; --accent:#22d3ee;
    --field:#0f1a2b; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
  }
  *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,#0b1220,#0b1220ee 70%,transparent);backdrop-filter:blur(6px);border-bottom:1px solid var(--line);margin-bottom:14px}
  h1{font-size:22px;margin:10px 0 8px} .sub{color:var(--muted);margin:0 0 8px}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(230px,1fr))}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin:14px 0}
  .card h2{font-size:16px;margin:0 0 8px}
  label{display:block;color:var(--muted);font-size:13px;margin:8px 0 6px}
  input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:var(--field);color:var(--ink);outline:none}
  textarea{min-height:110px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .pill{display:inline-block;padding:6px 9px;border:1px solid var(--line);border-radius:999px;background:var(--field);margin:4px 6px 0 0;font-size:12px;color:var(--muted)}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);background:#132035;color:var(--ink);padding:10px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{border-color:var(--accent)}
  .btn.primary{background:#122b3f}
  .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:8px}
  .kpi .box{border:1px solid var(--line);border-radius:12px;padding:10px;background:#122036;text-align:center}
  .kpi .box b{display:block;font-size:22px;margin-top:4px}
  .hint{color:var(--muted);font-size:12px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
</style>
</head>
<body>
  <header class="wrap">
    <h1>EPOC — Evaluación y Estratificación</h1>
    <p class="sub">Borrador clínico para consulta externa. Datos mínimos y salida resumida. (Sin guardar datos del paciente)</p>
  </header>

  <main class="wrap">
    <!-- 1) Datos básicos -->
    <section class="card">
      <h2>1) Datos básicos</h2>
      <div class="grid">
        <div>
          <label>Nombre (opcional)</label>
          <input id="nombre" placeholder="Iniciales o código">
        </div>
        <div>
          <label>Edad (años)</label>
          <input id="edad" type="number" min="0" inputmode="numeric">
        </div>
        <div>
          <label>Tabaquismo</label>
          <select id="tabaquismo">
            <option value="Nunca">Nunca</option>
            <option value="Exfumador">Exfumador</option>
            <option value="Actual">Actual</option>
          </select>
        </div>
        <div>
          <label>Exacerbaciones el último año</label>
          <input id="exac" type="number" min="0" value="0">
        </div>
      </div>
      <div class="row">
        <span class="pill">Añade espirometría cuando la tengas</span>
        <span class="pill">mMRC/CAT para síntomas</span>
      </div>
    </section>

    <!-- 2) Síntomas y espirometría -->
    <section class="card">
      <h2>2) Síntomas y espirometría</h2>
      <div class="grid">
        <div>
          <label>mMRC (0–4)</label>
          <input id="mmrc" type="number" min="0" max="4" value="0">
        </div>
        <div>
          <label>CAT (0–40)</label>
          <input id="cat" type="number" min="0" max="40" value="0">
        </div>
        <div>
          <label>FEV1 % predicho</label>
          <input id="fev1" type="number" min="0" max="150" placeholder="%" >
        </div>
        <div>
          <label>FVC % predicho (opcional)</label>
          <input id="fvc" type="number" min="0" max="150" placeholder="%">
        </div>
      </div>

      <div class="kpi">
        <div class="box"><span>Síntomas</span><b id="kpi-sintomas">Bajos</b><span class="hint">mMRC≥2 o CAT≥10 → Altos</span></div>
        <div class="box"><span>Riesgo</span><b id="kpi-riesgo">Bajo</b><span class="hint">Exacerbaciones ≥2 o 1 con ingreso → Alto</span></div>
        <div class="box"><span>GOLD (orientativo)</span><b id="kpi-gold">Pendiente</b><span class="hint">Basado en FEV1 %</span></div>
      </div>
    </section>

    <!-- 3) Comorbilidades / hallazgos -->
    <section class="card">
      <h2>3) Comorbilidades y hallazgos</h2>
      <div class="row" style="flex-wrap:wrap">
        <span class="pill">HTA</span><span class="pill">DM2</span><span class="pill">Cardiopatía</span>
        <span class="pill">FA</span><span class="pill">ERC</span><span class="pill">Ansiedad/Depresión</span>
      </div>
      <label style="margin-top:10px">Notas</label>
      <textarea id="notas" placeholder="Otros hallazgos relevantes, saturación basal, Rx/TC, eosinófilos, etc."></textarea>
    </section>

    <!-- 4) Plan y salida -->
    <section class="card">
      <h2>4) Plan y salida</h2>
      <div class="grid">
        <div>
          <label>Tratamiento inhalado propuesto</label>
          <input id="tx" placeholder="LABA/LAMA/ICS…">
        </div>
        <div>
          <label>Vacunación</label>
          <input id="vac" placeholder="Influenza, Neumococo…">
        </div>
        <div>
          <label>Rehabilitación respiratoria</label>
          <select id="rehab">
            <option>Pendiente</option><option>Indicada</option><option>En curso</option><option>No aplica</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px;gap:8px">
        <button class="btn primary" id="btn-resumen">Generar resumen</button>
        <button class="btn" id="btn-copiar">Copiar</button>
        <span class="hint">El resumen no guarda datos; úsalo para tu nota clínica.</span>
      </div>

      <label style="margin-top:12px">Salida — Bloque delimitado</label>
      <textarea id="salida" readonly></textarea>
    </section>
  </main>

<script>
  // Utilidades simples
  const $ = sel => document.querySelector(sel);
  const valN = id => Number((document.getElementById(id).value||"").replace(',','.')) || 0;

  function clasSintomas(mmrc, cat){
    const altos = (mmrc >= 2) || (cat >= 10);
    return altos ? "Altos" : "Bajos";
  }
  function clasRiesgo(exac){ return (exac >= 2) ? "Alto" : "Bajo"; }
  function clasGOLD(fev1){
    if(!fev1) return "Pendiente";
    if(fev1 >= 80) return "GOLD 1";
    if(fev1 >= 50) return "GOLD 2";
    if(fev1 >= 30) return "GOLD 3";
    return "GOLD 4";
  }

  function actualizarKPIs(){
    const mmrc = valN("mmrc"), cat = valN("cat"), exac = valN("exac"), fev1 = valN("fev1");
    $("#kpi-sintomas").textContent = clasSintomas(mmrc, cat);
    $("#kpi-riesgo").textContent = clasRiesgo(exac);
    $("#kpi-gold").textContent = clasGOLD(fev1);
  }
  ["mmrc","cat","exac","fev1"].forEach(id => document.getElementById(id).addEventListener("input", actualizarKPIs));
  actualizarKPIs();

  function generarResumen(){
    const nombre = $("#nombre").value || "Paciente";
    const edad = $("#edad").value || "—";
    const mmrc = $("#mmrc").value || "—";
    const cat = $("#cat").value || "—";
    const exac = $("#exac").value || 0;
    const fev1 = $("#fev1").value || "—";
    const taba = $("#tabaquismo").value;
    const gold = $("#kpi-gold").textContent;
    const sint = $("#kpi-sintomas").textContent;
    const riesgo = $("#kpi-riesgo").textContent;
    const tx = $("#tx").value || "A definir";
    const vac = $("#vac").value || "Pendiente";
    const rehab = $("#rehab").value;
    const notas = $("#notas").value || "";

    const bloque = [
      "----- EPOC | Evaluación y Estratificación -----",
      `Paciente: ${nombre} | Edad: ${edad} | Tabaquismo: ${taba}`,
      `Síntomas: mMRC ${mmrc} / CAT ${cat} → ${sint}`,
      `Exacerbaciones último año: ${exac} → Riesgo ${riesgo}`,
      `Espirometría: FEV1 % ${fev1} → ${gold}`,
      `Plan: ${tx} | Rehabilitación: ${rehab} | Vacunación: ${vac}`,
      (notas ? `Notas: ${notas}` : ""),
      "-----------------------------------------------"
    ].filter(Boolean).join("\n");
    $("#salida").value = bloque;
  }
  $("#btn-resumen").addEventListener("click", generarResumen);

  $("#btn-copiar").addEventListener("click", async () => {
    try{ await navigator.clipboard.writeText($("#salida").value); $("#btn-copiar").textContent = "¡Copiado!"; setTimeout(()=>$("#btn-copiar").textContent="Copiar",1400); }
    catch{ alert("No se pudo copiar. Selecciona y copia manualmente."); }
  });
</script>
</body>
</html>
